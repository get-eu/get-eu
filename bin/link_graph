#!/usr/bin/env python

import sys
import re
import os

markdown_link = re.compile(r'\[[^\]]+\]\((.*)\)')

def get_links(filename):
    with file(filename) as f:
        data = f.read()

    links = re.findall(markdown_link, data)
    no_external = lambda i: not i.startswith("http")
    return filter(no_external, links)

def all_files():
    for filename in os.listdir(os.curdir):
        if filename.endswith('.md'):
            yield filename

def slug(name):
    return re.sub(r'[^a-zA-Z0-9]', '_', name)

def edges():
    for filename in all_files():
        yield slug(filename)

        for link in get_links(filename):
            e = slug(filename) + " -> " + slug(link)
            yield e

def run():
    print "digraph get_eu {"
    for edge in edges():
        print "\t%s;" % edge
    print "}"

if __name__ == '__main__':
    run()
